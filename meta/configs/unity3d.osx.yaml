- defaults:
    link:
      create: true
      relink: true
      force: true
- link:
    ~/.Unity3D: apps/Unity3D

- brew:
  - imagemagick
  - librsvg
  - pcre
  - rbenv

- cask:
  - homebrew/cask-versions/adoptopenjdk8 # java8: it's gone from Homebrew, use OpenJDK instead (adoptopenjdk8)
  - android-sdk
  - fastlane

- shell++:
  - description: Pre-install latest version of Unity3D
    condition: 'true'
  - stderr: true
    command: |
      # See https://stackoverflow.com/questions/9132826/stop-developer-tools-access-needs-to-take-control-of-another-process-for-debugg
      sudo /usr/sbin/DevToolsSecurity --enable

      ~/.Unity3D/unity-init.sh

      # ~/.Unity3D/unity-install.sh 2018.1 9f2
      ~/.Unity3D/unity-install.sh 2018.4 3f1
      ~/.Unity3D/unity-install.sh 2019.1 10f1
      ~/.Unity3D/unity-install.sh 2019.2 12f1

- shell++:
  - description: Install cocoapods for build iOS
    condition: 'true'
  - stderr: true
    command: |
      RUBY_VERSION=2.4.2
      if [ -f ~/.ruby-version ];then
        RUBY_VERSION=$(cat ~/.ruby-version)
      fi

      # Install Ruby for fastlane
      rbenv init
      echo N | rbenv install $RUBY_VERSION

      # Install bundle package manager
      rbenv rehash
      rbenv shell $RUBY_VERSION
      gem install activesupport -v 4.2.6
      gem install bundle cocoapods
      rbenv rehash

      # Fix VSTS execute bash with --no-profile that will force rbenv use system Ruby.
      rbenv global $RUBY_VERSION

- shell++:
  - description: Accept all licenses
    condition: 'true'
  - stderr: true
    command: |
      touch ~/.android/repositories.cfg

      # yes | sdkmanager --licenses
      # Can NOT use yes pipe that will cause deadlock
      sdkmanager --licenses

- shell++:
  - description: Pre-install Android SDKs
    condition: 'true'
  - stderr: true
    command: |
      mkdir -p /usr/local/share/android-ndk/

      # For Unity3D 2018.1.0f2
      # wget -qO- https://dl.google.com/android/repository/android-ndk-r13b-darwin-x86_64.zip | tar xz - -C /usr/local/share/android-ndk/

      # For Unity3D 2018.3+
      wget -qO- https://dl.google.com/android/repository/android-ndk-r16b-darwin-x86_64.zip | tar xz - -C /usr/local/share/android-ndk/

      # Android SDK build tools
      echo y | sdkmanager "tools" "platform-tools" "build-tools;28.0.3"

      echo y | sdkmanager "extras;android;m2repository"
      echo y | sdkmanager "platforms;android-16" "sources;android-16"
      echo y | sdkmanager "platforms;android-26" "sources;android-26"
      # echo y | sdkmanager "platforms;android-27" "sources;android-27"
      # echo y | sdkmanager "platforms;android-28" "sources;android-28"
      echo y | sdkmanager "platforms;android-29" "sources;android-29" # platforms;android-29 is required for build AndroidX by Unity
